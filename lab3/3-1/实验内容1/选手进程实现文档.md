ä½ è¯´å¾—å¯¹ï¼æˆ‘è¿‡åº¦è®¾è®¡äº†ã€‚é€‰æ‰‹è¿›ç¨‹åº”è¯¥å¾ˆç®€å•ï¼š

# player é€‰æ‰‹è¿›ç¨‹

<br>

## åŠŸèƒ½æ¦‚è¿°
é€‰æ‰‹è¿›ç¨‹æ˜¯æ¸¸æˆçš„ç®€å•å‚ä¸è€…ï¼Œè´Ÿè´£ï¼š
1. **è¿æ¥æ¶ˆæ¯é˜Ÿåˆ—** - è¿æ¥åˆ°è£åˆ¤åˆ›å»ºçš„æ¶ˆæ¯é˜Ÿåˆ—
2. **å‘ŠçŸ¥è¿æ¥** - å‘è£åˆ¤å‘é€è¿æ¥ç¡®è®¤
3. **å“åº”è¯·æ±‚** - æ¥æ”¶è£åˆ¤çš„å‡ºæ‹³æŒ‡ä»¤å¹¶å›å¤éšæœºé€‰æ‹©
4. **è¢«åŠ¨é€€å‡º** - ç”±è£åˆ¤è¿›ç¨‹æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ

<br>

## ğŸ¯ å®é™…ä»£ç æµç¨‹ï¼š
```
â†’ è¿æ¥æ¶ˆæ¯é˜Ÿåˆ— 
â†’ å‘é€è¿æ¥ç¡®è®¤
â†’ ç­‰å¾…è£åˆ¤æŒ‡ä»¤ â†’ æ¥æ”¶æ¶ˆæ¯ â†’ å›å¤éšæœºå‡ºæ‹³
â†’ (è£åˆ¤ç»“æŸæ¸¸æˆæ—¶è‡ªåŠ¨é€€å‡º)
```

<br>

## æ ¸å¿ƒä»£ç å®ç°

#### 1. è¿æ¥æ¶ˆæ¯é˜Ÿåˆ—
```c
int get_message_queue() {
    key_t key = ftok("/tmp", 'R');
    int msgid = msgget(key, 0666);
    if (msgid == -1) {
        perror("msgget failed - è¯·å…ˆå¯åŠ¨è£åˆ¤è¿›ç¨‹");
        exit(1);
    }
    return msgid;
}
```

<br>

#### 2. å‘é€è¿æ¥ç¡®è®¤
```c
// å‘é€è¿æ¥ç¡®è®¤æ¶ˆæ¯
void send_connection_message(int msgid, int player_id)
{
    struct msg_packet message;
    message.msg_type = MSG_TYPE_CONNECT_ACK;
    message.player_id = player_id;
    message.choice = 0;
    message.round = 0;
    printf("ç©å®¶%d å‘é€è¿æ¥è¯·æ±‚\n", player_id);
    if (msgsnd(msgid, &message, sizeof(message) - sizeof(long), 0) == -1)
    {
        perror("å‘é€è¿æ¥æ¶ˆæ¯å¤±è´¥");
        exit(1);
    }
    else
    {
        printf("ç©å®¶%d: å·²è¿æ¥\n", player_id);
    }
}
```

<br>

#### 3. å¤„ç†è£åˆ¤æ¶ˆæ¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
```c
void handle_referee_message(int msgid, int player_id) {
    struct msg_packet message;
    
    while (1) {
        // é˜»å¡ç­‰å¾…è£åˆ¤æŒ‡ä»¤
        msgrcv(msgid, &message, sizeof(message) - sizeof(long), player_id, 0);
        
        // éšæœºå‡ºæ‹³
        message.choice = rand() % 3;
        message.msg_type = player_id | 4;  // å›å¤æ¶ˆæ¯ç±»å‹
        
        // å›å¤è£åˆ¤
        msgsnd(msgid, &message, sizeof(message) - sizeof(long), 0);
        
        printf("ç©å®¶%d: ç¬¬%då›åˆå‡ºæ‹³ %s\n", 
               player_id, message.round,
               message.choice == 0 ? "çŸ³å¤´" :
               message.choice == 1 ? "å‰ªåˆ€" : "å¸ƒ");
    }
}
```

<br>

#### 4. ä¸»ç¨‹åº
```c
int main() {
    srand(time(NULL) + getpid());
    
    printf("ç©å®¶è¿›ç¨‹å¯åŠ¨\n");
    int msgid = get_message_queue();
    int player_id = (getpid() % 2) + 1;
    
    send_connection_message(msgid, player_id);
    handle_referee_message(msgid, player_id);
    
    return 0;
}
```

<br>

## è®¾è®¡ç‰¹ç‚¹

1. **æç®€è®¾è®¡** - åªåšæœ€åŸºæœ¬çš„æ¶ˆæ¯æ”¶å‘
2. **è¢«åŠ¨å“åº”** - å®Œå…¨ç”±è£åˆ¤é©±åŠ¨
3. **æ— çŠ¶æ€** - ä¸è®°å½•æ¸¸æˆçŠ¶æ€ï¼Œåªå“åº”å½“å‰å›åˆ
4. **è‡ªåŠ¨é€€å‡º** - å½“è£åˆ¤ç»“æŸæ¸¸æˆæ—¶è‡ªç„¶é€€å‡º

**é€‰æ‰‹è¿›ç¨‹å°±æ˜¯ä¸ª"åº”ç­”æœº"**ï¼Œæ‰€æœ‰æ¸¸æˆé€»è¾‘éƒ½åœ¨è£åˆ¤è¿›ç¨‹ä¸­ã€‚


#### 5. æ–°æ·»: ç©å®¶ä»è£åˆ¤è·å–ç©å®¶ID
```c
#define MSG_TYPE_ID_ASSIGN 100   // è£åˆ¤â†’ç©å®¶ï¼šåˆ†é…ID
#define MSG_TYPE_CONNECT_ACK 101 // ç©å®¶â†’è£åˆ¤ï¼šè¿æ¥ç¡®è®¤

int get_assigned_id(int msgid)
{
    struct msg_packet message;
    msgrcv(msgid, &message, sizeof(message) - sizeof(long), MSG_TYPE_ID_ASSIGN, 0);
    return message.player_id;
}

```