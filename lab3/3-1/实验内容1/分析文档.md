
# 石头剪刀布多进程游戏 - 分析文档

## 目录结构
- referee.c     裁判进程
- player.c      玩家进程
- Makefile      编译文件

## 系统架构

### 进程关系
```
裁判进程 (referee)
    │
    ├── 创建消息队列
    │
    ├── 玩家进程1 (player1)
    │
    └── 玩家进程2 (player2)
```

### 通信机制
- **消息队列**：进程间通信的核心
- **消息类型**：
  - 裁判→玩家：类型为玩家ID {1, 2}
  - 玩家→裁判：类型为玩家 (ID | 4)

## referee 裁判进程

### 功能概述
裁判进程是整个游戏的控制中心，负责：
1. 创建和管理消息队列
2. 协调游戏回合 （超时判断）
3. 判断胜负
4. 统计最终结果


### 消息流时序
```
裁判进程          消息队列          玩家进程
   | -- type=2 -->  |               |
   |                | -- type=2 --> | (玩家2)
   |                | <-- type=6 -- | 
   | <-- type=6 --  |               |
   |                |               |
   | -- type=1 -->  |               |
   |                | -- type=1 --> | (玩家1)
   |                | <-- type=5 -- |
   | <-- type=5 --  |               |
```


---------------------------------------------------------------
---------------------------------------------------------------


## player 玩家进程

### 功能概述
1. 连接到相同的消息队列
2. 等待裁判的出拳指令
3. 随机生成出拳选择（0:石头, 1:剪刀, 2:布）
4. 回复裁判

## 游戏规则

### 出拳编码
- `0` = 石头
- `1` = 剪刀  
- `2` = 布
- `-1` = 超时（判负）

### 胜负关系
x 赢 y <==> x + 1 = y (mod 3)
``` 示例
石头(0) 胜 剪刀(1)
剪刀(1) 胜 布(2)  
布(2) 胜 石头(0)
```

### 超时处理
- 玩家在规定时间内未回复视为超时
- 超时玩家直接判负

## 编译运行


### 编译命令

```bash
    make
```

### 运行方式
```bash
# 终端1：启动裁判进程
./referee 5 # 进行5轮比赛 默认id1 = 1, id2 = 2

# 终端2：启动玩家1
./player 

# 终端3：启动玩家2  
./player 
```